project(OP2-Jac1-DP)

# Require CMake 2.8
cmake_minimum_required(VERSION 2.8)

include(../../common.cmake)

# simple sequential version
if (TARGET op2_seq)
  add_executable(jac1_dp_seq jac.cpp res.h update.h)
  target_link_libraries(jac1_dp_seq op2_seq)
  install(TARGETS jac1_dp_seq RUNTIME DESTINATION ${OP2_APPS_DIR} COMPONENT RuntimeExecutables)
endif()

# x86 version using kernel files generated by op2.m
if (TARGET op2_openmp)
  add_executable(jac1_dp_openmp jac_op.cpp jac_kernels.cpp res.h update.h)
  target_link_libraries(jac1_dp_openmp op2_openmp)
  set_target_properties(jac1_dp_openmp PROPERTIES COMPILE_FLAGS
    "${OpenMP_CXX_FLAGS}" LINK_FLAGS "${OpenMP_CXX_FLAGS}")
  install(TARGETS jac1_dp_openmp RUNTIME DESTINATION ${OP2_APPS_DIR} COMPONENT RuntimeExecutables)
endif()

# CUDA version using kernel files generated by op2.m
if (TARGET op2_cuda)
  find_package(CUDA)
  if (CUDA_FOUND)
    cuda_add_executable(jac1_dp_cuda jac_op.cpp jac_kernels.cu res.h update.h)
    target_link_libraries(jac1_dp_cuda op2_cuda)
    install(TARGETS jac1_dp_cuda RUNTIME DESTINATION ${OP2_APPS_DIR} COMPONENT RuntimeExecutables)
  endif()
endif()

# MPI with sequential-nodes version
if (TARGET op2_mpi)
  add_definitions(${OP2_MPI_DEFINITIONS})
  include_directories(${OP2_MPI_INCLUDE_DIRS})
  add_executable(jac1_dp_mpi jac_mpi.cpp res.h update.h)
  target_link_libraries(jac1_dp_mpi op2_mpi)
  install(TARGETS jac1_dp_mpi RUNTIME DESTINATION ${OP2_APPS_DIR} COMPONENT RuntimeExecutables)
endif()
